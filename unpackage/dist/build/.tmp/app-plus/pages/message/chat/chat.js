(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/chat/chat"],{"3fd6":function(t,e,s){"use strict";s.r(e);var i=s("d668"),n=s.n(i);for(var a in i)"default"!==a&&function(t){s.d(e,t,function(){return i[t]})}(a);e["default"]=n.a},"42f2":function(t,e,s){"use strict";var i=s("ddd4"),n=s.n(i);n.a},"5f59":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return n})},"64a6":function(t,e,s){},"7da4":function(t,e,s){"use strict";s.r(e);var i=s("5f59"),n=s("3fd6");for(var a in n)"default"!==a&&function(t){s.d(e,t,function(){return n[t]})}(a);s("e96f"),s("42f2");var o=s("2877"),u=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,"5280f7fd",null);e["default"]=u.exports},c144:function(t,e,s){"use strict";(function(t){s("4ea4"),s("921b");i(s("66fd"));var e=i(s("7da4"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("6e42")["createPage"])},d668:function(t,e,s){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s("2f62");function a(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{},i=Object.keys(s);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),i.forEach(function(e){o(t,e,s[e])})}return t}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var u={data:function(){return{user:null,textMsg:"",isHistoryLoading:!1,scrollAnimation:!1,scrollTop:0,scrollToView:"",pageNum:1,pageSize:20,more:!0,msgList:[],myuid:0,msg:null}},onShareAppMessage:function(){var e=t.getStorageSync("TOKEN"),s=t.getStorageSync("userInfo");if(e)return{title:"易建联共享服务平台",path:"/pages/index/index?server="+s.server_people_id}},computed:a({},(0,n.mapState)(["userInfo","uList","msgNum"])),onLoad:function(e){var s=this;if(e.user){var n=JSON.parse(e.user),a=this.uList;n.user_id&&(n.id=n.user_id),console.log(i(n.count," at pages/message/chat/chat.vue:106")),n.count&&this.setMsgNum(this.msgNum-n.count);var o=!0,u=!1,r=void 0;try{for(var c,l=a[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var g=c.value;g.id===n.id&&(g.count=0)}}catch(h){u=!0,r=h}finally{try{o||null==l.return||l.return()}finally{if(u)throw r}}this.updateUlist(a),this.user=n,t.setNavigationBarTitle({title:n.user_name}),this.getMsgList(),this.$Fetch({url:"user_chat/NoReadNum",success:function(t){console.log(i("未读消息",t," at pages/message/chat/chat.vue:124")),s.setMsgNum(t)}})}t.$on("onMessage",function(e){"text"===e.type?(s.msgList.push(e),console.log(i(s.msgList.length-1," at pages/message/chat/chat.vue:133")),s.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1)})):"outline"===e.type?(t.showModal({content:"对方离线，只能发送一条离线消息",showCancel:!1}),s.screenMsg(s.msg),s.textMsg="",s.msg=null):"success"===e.type&&(s.screenMsg(s.msg),s.textMsg="",s.msg=null)})},onUnload:function(){t.$off("onMessage")},methods:a({},(0,n.mapMutations)(["addUlist","setMsgNum","updateUlist"]),{screenMsg:function(e){t.hideKeyboard(),this.msgList.push(e),this.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1)})},hideDrawer:function(){},loadHistory:function(){var t=this;this.more&&(this.more=!1,this.isHistoryLoading=!0,this.scrollAnimation=!1,this.$Fetch({url:"user_chat/getData",data:{to_user_id:this.user.id,pageNum:this.pageNum,pageSize:this.pageSize},success:function(e){setTimeout(function(){e.length>0&&(t.msgList=e.reverse().concat(t.msgList),e.length===t.pageSize?(t.more=!0,t.$nextTick(function(){console.log(i(this.msgList.length-1," at pages/message/chat/chat.vue:194")),this.scrollToView="msg"+e.length,this.$nextTick(function(){this.scrollAnimation=!0})}),t.isHistoryLoading=!1,t.pageNum++):t.isHistoryLoading=!1)},1500)}}))},getMsgList:function(){var t=this;this.more=!1,this.scrollAnimation=!1,this.$Fetch({url:"user_chat/getData",data:{to_user_id:this.user.id,pageNum:this.pageNum,pageSize:this.pageSize},success:function(e){e.length>0&&(t.msgList=e.reverse().concat(t.msgList),e.length===t.pageSize&&(t.more=!0,t.pageNum++),t.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1),this.$nextTick(function(){this.scrollAnimation=!0})}))}})},sendText:function(){console.log(i(this.userInfo," at pages/message/chat/chat.vue:242"));new Date;var e={content:this.textMsg,to_user_id:this.user.id,to_user_name:this.user.user_name,to_user_img:this.user.head_img,user_id:this.userInfo.id,user_name:this.userInfo.user_name,user_img:this.userInfo.head_img,type:"say"};if(this.textMsg.trim()){var s=this;this.msg=e,t.sendSocketMessage({data:JSON.stringify(e),success:function(){s.$Fetch({url:"user_chat/getDataList",success:function(t){s.updateUlist(t)}})}})}else t.showModal({content:"不能发送空白消息",showCancel:!1})},discard:function(){}})};e.default=u}).call(this,s("6e42")["default"],s("0de9")["default"])},ddd4:function(t,e,s){},e96f:function(t,e,s){"use strict";var i=s("64a6"),n=s.n(i);n.a}},[["c144","common/runtime","common/vendor"]]]);