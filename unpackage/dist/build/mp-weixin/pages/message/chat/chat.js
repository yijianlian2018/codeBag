(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/chat/chat"],{"3fd6":function(t,e,s){"use strict";s.r(e);var i=s("d668"),n=s.n(i);for(var o in i)"default"!==o&&function(t){s.d(e,t,function(){return i[t]})}(o);e["default"]=n.a},"42f2":function(t,e,s){"use strict";var i=s("ddd4"),n=s.n(i);n.a},"5f59":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return n})},"64a6":function(t,e,s){},"7da4":function(t,e,s){"use strict";s.r(e);var i=s("5f59"),n=s("3fd6");for(var o in n)"default"!==o&&function(t){s.d(e,t,function(){return n[t]})}(o);s("e96f"),s("42f2");var r=s("2877"),u=Object(r["a"])(n["default"],i["a"],i["b"],!1,null,"5280f7fd",null);e["default"]=u.exports},c144:function(t,e,s){"use strict";(function(t){s("4ea4"),s("921b");i(s("66fd"));var e=i(s("7da4"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},d668:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s("2f62");function n(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{},i=Object.keys(s);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),i.forEach(function(e){o(t,e,s[e])})}return t}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var r={data:function(){return{user:null,textMsg:"",isHistoryLoading:!1,scrollAnimation:!1,scrollTop:0,scrollToView:"",pageNum:1,pageSize:20,more:!0,msgList:[],myuid:0,msg:null}},onShareAppMessage:function(){var e=t.getStorageSync("TOKEN"),s=t.getStorageSync("userInfo");if(e)return{title:"易建联共享服务平台",path:"/pages/index/index?server="+s.server_people_id}},computed:n({},(0,i.mapState)(["userInfo","uList","msgNum"])),onLoad:function(e){var s=this;if(e.user){var i=JSON.parse(e.user),n=this.uList;i.user_id&&(i.id=i.user_id),console.log(i.count),i.count&&this.setMsgNum(this.msgNum-i.count);var o=!0,r=!1,u=void 0;try{for(var a,c=n[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;l.id===i.id&&(l.count=0)}}catch(g){r=!0,u=g}finally{try{o||null==c.return||c.return()}finally{if(r)throw u}}this.updateUlist(n),this.user=i,t.setNavigationBarTitle({title:i.user_name}),this.getMsgList(),this.$Fetch({url:"user_chat/NoReadNum",success:function(t){console.log("未读消息",t),s.setMsgNum(t)}})}t.$on("onMessage",function(e){"text"===e.type?(s.msgList.push(e),console.log(s.msgList.length-1),s.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1)})):"outline"===e.type?(t.showModal({content:"对方离线，只能发送一条离线消息",showCancel:!1}),s.screenMsg(s.msg),s.textMsg="",s.msg=null):"success"===e.type&&(s.screenMsg(s.msg),s.textMsg="",s.msg=null)})},onUnload:function(){t.$off("onMessage")},methods:n({},(0,i.mapMutations)(["addUlist","setMsgNum","updateUlist"]),{screenMsg:function(e){t.hideKeyboard(),this.msgList.push(e),this.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1)})},hideDrawer:function(){},loadHistory:function(){var t=this;this.more&&(this.more=!1,this.isHistoryLoading=!0,this.scrollAnimation=!1,this.$Fetch({url:"user_chat/getData",data:{to_user_id:this.user.id,pageNum:this.pageNum,pageSize:this.pageSize},success:function(e){setTimeout(function(){e.length>0&&(t.msgList=e.reverse().concat(t.msgList),e.length===t.pageSize?(t.more=!0,t.$nextTick(function(){console.log(this.msgList.length-1),this.scrollToView="msg"+e.length,this.$nextTick(function(){this.scrollAnimation=!0})}),t.isHistoryLoading=!1,t.pageNum++):t.isHistoryLoading=!1)},1500)}}))},getMsgList:function(){var t=this;this.more=!1,this.scrollAnimation=!1,this.$Fetch({url:"user_chat/getData",data:{to_user_id:this.user.id,pageNum:this.pageNum,pageSize:this.pageSize},success:function(e){e.length>0&&(t.msgList=e.reverse().concat(t.msgList),e.length===t.pageSize&&(t.more=!0,t.pageNum++),t.$nextTick(function(){this.scrollToView="msg"+(this.msgList.length-1),this.$nextTick(function(){this.scrollAnimation=!0})}))}})},sendText:function(){console.log(this.userInfo);new Date;var e={content:this.textMsg,to_user_id:this.user.id,to_user_name:this.user.user_name,to_user_img:this.user.head_img,user_id:this.userInfo.id,user_name:this.userInfo.user_name,user_img:this.userInfo.head_img,type:"say"};if(this.textMsg.trim()){var s=this;this.msg=e,t.sendSocketMessage({data:JSON.stringify(e),success:function(){s.$Fetch({url:"user_chat/getDataList",success:function(t){s.updateUlist(t)}})}})}else t.showModal({content:"不能发送空白消息",showCancel:!1})},discard:function(){}})};e.default=r}).call(this,s("543d")["default"])},ddd4:function(t,e,s){},e96f:function(t,e,s){"use strict";var i=s("64a6"),n=s.n(i);n.a}},[["c144","common/runtime","common/vendor"]]]);