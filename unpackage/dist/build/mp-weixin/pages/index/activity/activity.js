(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/activity/activity"],{"4d19":function(t,e,n){},"6b3d":function(t,e,n){"use strict";var i=n("4d19"),o=n.n(i);o.a},adbe:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=(t._self._c,JSON.stringify(t.author));t._isMounted||(t.e0=function(e){t.show=!0},t.e1=function(e){t.showInput=!0},t.e2=function(e){t.show=!1}),t.$mp.data=Object.assign({},{$root:{g0:n}})},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},bcd5:function(t,e,n){"use strict";n.r(e);var i=n("de7d"),o=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},d313:function(t,e,n){"use strict";(function(t){n("4ea4"),n("921b");i(n("66fd"));var e=i(n("f054"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},de7d:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n("2f62");function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){s(t,e,n[e])})}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"4155"))},c={data:function(){return{type:0,id:-1,activity:null,author:null,attention:0,is_collect:0,is_like:0,is_baoming:0,max:1,height:0,show:!1,pl:!1,comment:{pageNum:1,pageSize:10,list:[],loading:!0,more:!1},reply:{comment:{},pageNum:1,pageSize:10,list:[],loading:!0,more:!1},replyId:-1,to_user_name:"",showInput:!1,showInput1:!1,content:"",content1:""}},computed:o({},(0,i.mapState)(["isLogin","userInfo"])),components:{uniPopup:a},onShareAppMessage:function(){var e=t.getStorageSync("TOKEN"),n=t.getStorageSync("userInfo");if(this.$Fetch({url:"activity/share",data:{activity_id:this.id},success:function(e){var n=e>0?"已分享,砖瓦+"+e:"已分享";t.showToast({title:n,icon:"none"})}}),e)return{title:"易建联共享服务平台",path:"/pages/index/activity/activity?id="+this.id+"&server="+n.server_people_id+"&path=/pages/index/activity/activity"}},onLoad:function(e){var n=t.getStorageSync("TOKEN"),i=this;if(!n)return this.setShareMsg({server:e.server,path:e.path+"?id="+e.id}),t.redirectTo({url:"/pages/login/login"}),!1;t.getSystemInfo({success:function(t){i.height=t.windowHeight/2+"px"}}),console.log("活动ID=",e.id),e.id&&(this.id=e.id,this.getActivity(e.id),this.getCommentList())},onReachBottom:function(){this.getCommentList()},onShow:function(){this.id>-1&&this.getActivity(this.id)},methods:{videoErrorCallback:function(){},doShare:function(){var e=this;t.share({provider:"weixin",scene:"WXSceneSession",type:5,imageUrl:"../../static/poster.png",title:"欢迎使用易建联APP",miniProgram:{id:"gh_4bf03e4d36fb",path:"/pages/index/activity/activity?id="+this.id+"&server="+this.userInfo.server_people_id+"&path=/pages/index/activity/activity",webUrl:"https://uniapp.dcloud.io",type:2},success:function(n){console.log("success",n),e.$Fetch({url:"activity/share",data:{activity_id:e.id},success:function(e){var n=e>0?"已分享,砖瓦+"+e:"已分享";t.showToast({title:n,icon:"none"})}})},fail:function(t){console.log("fail",t)},complete:function(){console.log("分享操作结束!")}})},send:function(){var e=this;if(!this.content.trim())return t.showModal({content:"请输入内容",showCancel:!1}),!1;this.$Fetch({url:"Comment/add",data:{comment_type:0,id_value:this.id,content:this.content},success:function(n){console.log(n);var i=new Date,o=i.getMonth()+1>9?i.getMonth()+1:"0"+(i.getMonth()+1),s=i.getDate()>9?i.getDate():"0"+i.getDate(),a=i.toTimeString().split(" ")[0];console.log(a),e.comment.list.unshift({user_id:e.userInfo.id,user_name:e.userInfo.user_name,content:e.content,create_time:i.getFullYear()+"-"+o+"-"+s+" "+a,like_num:0,head_img:e.userInfo.head_img,children:null,children_num:0,is_like:0}),e.content="",t.hideKeyboard(),e.showInput=!1}})},doReply:function(t,e){this.showInput1=!0,this.replyId=t,this.to_user_name=e},send1:function(){var e=this;if(!this.content1.trim())return t.showModal({content:"请输入内容",showCancel:!1}),!1;var n=this.reply.comment.id;this.$Fetch({url:"Comment/addComment",data:{parent_id:n,to_user_id:this.replyId,content:this.content1},success:function(n){console.log(n);var i=new Date,o=i.getMonth()+1>9?i.getMonth()+1:"0"+(i.getMonth()+1),s=i.getDate()>9?i.getDate():"0"+i.getDate(),a=i.toTimeString().split(" ")[0];console.log(a),e.replyId?(console.log("回复评论"),e.reply.list.unshift({user_id:e.userInfo.id,user_name:e.userInfo.user_name,content:e.content1,create_time:i.getFullYear()+"-"+o+"-"+s+" "+a,like_num:0,head_img:e.userInfo.head_img,is_like:0,to_user_name:e.to_user_name})):(console.log("回复回复"),e.reply.list.unshift({user_id:e.userInfo.id,user_name:e.userInfo.user_name,content:e.content1,create_time:i.getFullYear()+"-"+o+"-"+s+" "+a,like_num:0,head_img:e.userInfo.head_img,is_like:0,to_user_name:e.to_user_name})),e.content1="",t.hideKeyboard(),e.showInput1=!1}})},getActivity:function(t){var e=this;this.$Fetch({url:"activity/getDataById",data:{id:t},success:function(t){console.log(t),e.activity=t,e.author=t.adminUser,e.attention=t.attention,e.is_collect=t.is_collect,e.is_like=t.is_like,e.is_baoming=t.is_baoming,e.max=t.activity_num-t.people_num;var n=t.start_time.replace(/\-/g,"/"),i=t.end_time.replace(/\-/g,"/"),o=(new Date).getTime();o<new Date(n).getTime()?e.type=0:o<=new Date(i).getTime()?e.type=1:e.type=2}})},doAttention:function(e){var n=this;console.log("关注",e),this.$Fetch({url:"Attention/add",data:{id:e},debug:!0,success:function(e){console.log(e),n.attention=e.success;var i=1===e.success?"已关注,砖瓦+"+e.point:"已取消关注";t.showToast({title:i,icon:"none"})}})},doCollect:function(e){var n=this;this.$Fetch({url:"Collect/add",data:{collect_type:1,id_value:this.id},debug:!0,success:function(e){console.log(e),n.is_collect=e.success;var i=1===e.success?"已收藏,砖瓦+"+e.point:"已取消收藏";t.showToast({title:i,icon:"none"})}})},doZan:function(e){var n=this;this.$Fetch({url:"user_like/add",data:{like_type:1,id_value:this.id},success:function(e){console.log(e),n.is_like=e.success;var i=1===e.success?"已点赞,砖瓦+"+e.point:"已取消点赞";t.showToast({title:i,icon:"none"})}})},getCommentList:function(){var t=this,e=this.comment;e.loading&&(e.loading=!1,this.comment=e,this.$Fetch({url:"Comment/getData",data:{comment_type:0,id_value:this.id,pageNum:e.pageNum,pageSize:e.pageSize},success:function(n){var i=n.lists;i.length>0?(e.list=e.list.concat(i),i.length===e.pageSize?(e.pageNum++,e.loading=!0,e.more=!0):e.more=!1):e.more=!1,t.comment=e}}))},addCommentLike:function(t,e){this.$Fetch({url:"Comment/addCommentLike",data:{id:t.id},success:function(e){t.is_like=e,1===e?t.like_num++:t.like_num--}})},closePopup:function(){this.pl=!1,this.reply={comment:{},pageNum:1,pageSize:10,list:[],loading:!0,more:!1}},showPopup:function(t){this.getReply(t),this.pl=!0},getReply:function(t){var e=this,n=this.reply;n.comment=t,this.reply=n,n.loading&&(n.loading=!1,this.reply=n,this.$Fetch({url:"Comment/getComment",data:{id:t.id,pageNum:n.pageNum,pageSize:n.pageSize},debug:!0,success:function(t){var i=t.length;i>0?(n.list=n.list.concat(t),i===n.pageSize?(n.pageNum++,n.loading=!0,n.more=!0):n.more=!1):n.more=!1,e.reply=n,e.pl=!0}}))},onSubmit:function(e){console.log("提交数据：",e.detail.value),this.$Fetch({url:"activity_list/add",data:e.detail.value,success:function(e){console.log(e),t.navigateTo({url:"../success/success?id="+e})}})}}};e.default=c}).call(this,n("543d")["default"])},f054:function(t,e,n){"use strict";n.r(e);var i=n("adbe"),o=n("bcd5");for(var s in o)"default"!==s&&function(t){n.d(e,t,function(){return o[t]})}(s);n("6b3d");var a=n("2877"),c=Object(a["a"])(o["default"],i["a"],i["b"],!1,null,"007aef46",null);e["default"]=c.exports}},[["d313","common/runtime","common/vendor"]]]);